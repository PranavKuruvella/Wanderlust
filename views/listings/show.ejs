<% layout("/layouts/boilerplate") %>

    <body>
        <!-- listing section -->
        <div class="row">
            <div class="col-8 offset-2">
                <br>
                <div class="card listing-card text-center col-8 offset-2" id="show-card">
                    <img src="<%= listing.image %>" id="show-img" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h4 class="card-title">
                            <b>
                                <%= listing.title %>
                            </b>
                        </h4>
                        <h6 class="card-subtitle mb-2 text-body-secondary"> Owned by - <i>
                            <%= listing.owner.username %>
                        </i></h6>
                    </div>
                </div>

                <div class="offset-2 col-md-8">
                    <ul>
                        
                        <li>
                            <%= listing.description %>
                        </li>
                        <li> &#8377; <%= listing.price.toLocaleString("en-IN") %>
                        </li>
                        <li>
                            <%= listing.location %>
                        </li>
                        <li>
                            <%= listing.country %>
                        </li>
                    </ul>
                </div>

              <% if(currentUser && listing.owner._id.equals(currentUser._id)) { %>
                <div class="offset-4 show-btn">
                    <a href="/listings/<%= listing._id %>/edit" class="btn btn-primary">Edit Here</a>
                    <br>
                    <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
                        <button type="submit" class="btn btn-dark" id="show-btn">Delete This?</button>
                    </form>
                </div>
                <% } %>

                <hr>
            </div>

            <!-- Review Section -->
            <div class="col-8 offset-2 mb-3">
                <% if(currentUser){ %>
                    <h4>Leave a Review</h4>
                    <form method="POST" action="/listings/<%= listing.id %>/reviews" novalidate class="needs-validation">
                    <!-- Stars ki related -->
                    <div class="mb-3 mt-3">
                        <label class="form-label" for="rating">Rating</label>
                        <fieldset class="starability-slot" required>
                            <input class="form-check-input" type="radio" id="first-rate1" name="review[rating]"
                                value="1" />
                            <label class="form-check-label" for="first-rate1" title="Terrible"> 1 star</label>
                            <input class="form-check-input" type="radio" id="first-rate2" name="review[rating]"
                                value="2" />
                            <label class="form-check-label" for="first-rate2" title="Not good"> 2 stars</label>
                            <input class="form-check-input" type="radio" id="first-rate3" name="review[rating]"
                                value="3" checked />
                            <label class="form-check-label" for="first-rate3" title="Average"> 3 stars</label>
                            <input class="form-check-input" type="radio" id="first-rate4" name="review[rating]"
                                value="4" />
                            <label class="form-check-label" for="first-rate4" title="Very good"> 4 stars</label>
                            <input class="form-check-input" type="radio" id="first-rate5" name="review[rating]"
                                value="5" />
                            <label class="form-check-label" for="first-rate5" title="Amazing"> 5 stars</label>
                        </fieldset>
                    </div>

                    <!-- Comments Input  class="form-check-input" -->
                    <div class="mb-3 mt-3">
                        <label for="comment" class="form-label">Comments</label>
                        <textarea name="review[comment]" id="comment" cols="30" rows="5" class="form-control"
                            required></textarea>
                        <div class="invalid-feedback">Please write a valid Comments</div>
                    </div>
                    <button type="submit" class="btn btn-outline-dark">Submit</button>
                    </form>
                    <hr>
                <% } %>
                <!-- Showing all the reviews -->
                <div class="row">
                    <% if(listing.reviews.length > 0) { %>
                        <div class="row g-3">
                            <h3>All Reviews</h3>
                            <% for(let review of listing.reviews) { %>
                                <!-- Responsive Card -->
                                <div class="col-12 col-md-6 col-lg-6">
                                    <div class="card h-100 p-3">
                                        <div class="card-body">
                                            <h5 class="card-title"><i><%= review.author.username %></i></h5>
                                            <p class="starability-result card-text"> <b> Rating : <%= review.rating %> Stars </b> </p>
                                            <p class="card-text">
                                                <%= review.comment %>
                                            </p>
                                        </div>
                                        <!-- deletion of each review -->
                                        <% if(currentUser && review.author && review.author._id.equals(currentUser._id)) { %>
                                    <!-- what went wrong is nrml ga if nen login avvakunda just review delete click chesthe isLoggedIn trigger avi login page ki pothundhi after login manam redirect to original url ki chesthunam see userRoute but here is the thing redirect yemo get request pampisthundhi but manam rasindhi delete req so avvadhu ---- manam direct ga delete btn ee lepesam! Author ki matrame kanipisthundhii -->
                                        <form
                                            action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
                                            method="POST">
                                            <button type="submit" class="btn btn-sm btn-primary">Delete</button>
                                        </form>
                                        <% } %>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </body>